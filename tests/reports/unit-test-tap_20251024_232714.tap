1..20
ok 1 sanitize_wrapper_input: rejects empty input
not ok 2 sanitize_wrapper_input: accepts small safe input (<1KB)
# (from function `__assert_stream' in file /home/ryu/.nvm/versions/node/v22.18.0/lib/node_modules/bats-assert/src/assert_output.bash, line 244,
#  from function `assert_output' in file /home/ryu/.nvm/versions/node/v22.18.0/lib/node_modules/bats-assert/src/assert_output.bash, line 125,
#  in test file tests/unit/test-common-wrapper-lib.bats, line 28)
#   `assert_output "Hello World"' failed
#
# -- output differs --
# expected : Hello World
# actual   : Hello\ World
# --
#
ok 3 sanitize_wrapper_input: blocks dangerous characters in small input (<1KB)
ok 4 sanitize_wrapper_input: accepts medium safe input (1KB-100KB)
ok 5 sanitize_wrapper_input: blocks command injection in medium input (1KB-100KB)
ok 6 sanitize_wrapper_input: accepts large input (>100KB)
not ok 7 handle_wrapper_timeout: returns success for quick process
# (from function `assert_success' in file /home/ryu/.nvm/versions/node/v22.18.0/lib/node_modules/bats-assert/src/assert_success.bash, line 45,
#  in test file tests/unit/test-common-wrapper-lib.bats, line 87)
#   `assert_success' failed
#
# -- command failed --
# status : 255
# output :
# --
#
ok 8 handle_wrapper_timeout: times out slow process
ok 9 handle_wrapper_timeout: sends SIGTERM then SIGKILL
not ok 10 format_wrapper_output: formats text output
# (from function `__assert_stream' in file /home/ryu/.nvm/versions/node/v22.18.0/lib/node_modules/bats-assert/src/assert_output.bash, line 244,
#  from function `assert_output' in file /home/ryu/.nvm/versions/node/v22.18.0/lib/node_modules/bats-assert/src/assert_output.bash, line 125,
#  in test file tests/unit/test-common-wrapper-lib.bats, line 118)
#   `assert_output "Hello from AI"' failed
#
# -- output differs --
# expected (1 lines):
#   Hello from AI
# actual (4 lines):
#   === text Wrapper Result ===
#   Status:
#   Exit Code:
#   Duration: ms
# --
#
not ok 11 format_wrapper_output: formats JSON output
# (from function `fail' in file /home/ryu/.nvm/versions/node/v22.18.0/lib/node_modules/bats-support/src/error.bash, line 40,
#  from function `assert_output_contains' in file tests/unit/../helpers/test_helper.bash, line 81,
#  in test file tests/unit/test-common-wrapper-lib.bats, line 124)
#   `assert_output_contains '"status"'' failed
# Expected output to contain '"status"', got: === json Wrapper Result ===
# Status:
# Exit Code:
# Duration: ms
not ok 12 format_wrapper_output: defaults to text when format unspecified
# (from function `__assert_stream' in file /home/ryu/.nvm/versions/node/v22.18.0/lib/node_modules/bats-assert/src/assert_output.bash, line 244,
#  from function `assert_output' in file /home/ryu/.nvm/versions/node/v22.18.0/lib/node_modules/bats-assert/src/assert_output.bash, line 125,
#  in test file tests/unit/test-common-wrapper-lib.bats, line 132)
#   `assert_output "Default output"' failed
#
# -- output differs --
# expected (1 lines):
#   Default output
# actual (4 lines):
#   ===  Wrapper Result ===
#   Status:
#   Exit Code:
#   Duration: ms
# --
#
ok 13 wrapper_structured_error: outputs what/why/how pattern
ok 14 wrapper_structured_error: returns correct exit code
ok 15 wrapper_structured_error: uses WRAPPER_EXIT constants
ok 16 wrapper_print_stack_trace: outputs stack frames
ok 17 wrapper_print_stack_trace: limits to 20 frames
ok 18 error codes: WRAPPER_EXIT constants are defined
not ok 19 integration: sanitize + format output pipeline
# (from function `__assert_stream' in file /home/ryu/.nvm/versions/node/v22.18.0/lib/node_modules/bats-assert/src/assert_output.bash, line 244,
#  from function `assert_output' in file /home/ryu/.nvm/versions/node/v22.18.0/lib/node_modules/bats-assert/src/assert_output.bash, line 125,
#  in test file tests/unit/test-common-wrapper-lib.bats, line 240)
#   `assert_output "$input"' failed
#
# -- output differs --
# expected (1 lines):
#   Clean input text
# actual (4 lines):
#   === text Wrapper Result ===
#   Status:
#   Exit Code:
#   Duration: ms
# --
#
not ok 20 integration: error handling with stack trace
# (from function `assert_failure' in file /home/ryu/.nvm/versions/node/v22.18.0/lib/node_modules/bats-assert/src/assert_failure.bash, line 71,
#  in test file tests/unit/test-common-wrapper-lib.bats, line 253)
#   `assert_failure' failed
#
# -- command succeeded, but it was expected to fail --
# output (24 lines):
#   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#   ğŸš¨ ERROR [Exit Code: 1]
#   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#
#   âŒ What happened:
#      Test error in function
#
#   ğŸ” Why it happened:
#      Intentional test failure
#
#   âœ… How to fix:
#      This is a test, no fix needed
#
#   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#   ğŸ“š Stack Trace:
#   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#     â†’ error_func() at 1-test-common-wrapper-lib.bats.src:249  [error origin]
#     â†’ bats_merge_stdout_and_stderr() at test_functions.bash:158
#     â†’ run() at test_functions.bash:380
#     â†’ test_integration-3a_error_handling_with_stack_trace() at 1-test-common-wrapper-lib.bats.src:252
#     â†’ bats_perform_test() at bats-exec-test:355
#     â†’ main() at bats-exec-test:378
#   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# --
#
