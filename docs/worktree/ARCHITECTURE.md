# Git Worktrees ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** v1.0
**æœ€çµ‚æ›´æ–°:** 2025-11-08

---

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³](#ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³)
3. [ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¾å­˜é–¢ä¿‚](#ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¾å­˜é–¢ä¿‚)
4. [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼](#ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼)
5. [çŠ¶æ…‹é·ç§»](#çŠ¶æ…‹é·ç§»)
6. [ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä¾‹](#ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä¾‹)
7. [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ](#ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ )
8. [è¨­è¨ˆåŸå‰‡](#è¨­è¨ˆåŸå‰‡)

---

## æ¦‚è¦

Git Worktreesçµ±åˆã‚·ã‚¹ãƒ†ãƒ ã¯ã€7ã¤ã®AIï¼ˆClaudeã€Geminiã€Ampã€Qwenã€Droidã€Codexã€Cursorï¼‰ã‚’ç‹¬ç«‹ã—ãŸGit Worktreeã§ä¸¦åˆ—å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã•ã‚ŒãŸBashãƒ©ã‚¤ãƒ–ãƒ©ãƒªé›†ã§ã™ã€‚

**ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ:**
- **8ã¤ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª** - è²¬å‹™åˆ†é›¢ã«ã‚ˆã‚‹ä¿å®ˆæ€§å‘ä¸Š
- **72ã®é–¢æ•°** - å†åˆ©ç”¨å¯èƒ½ãªAPI
- **NDJSONå½¢å¼** - çŠ¶æ…‹ãƒ»å±¥æ­´ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®è¨˜éŒ²
- **Trapç®¡ç†** - ç•°å¸¸çµ‚äº†æ™‚ã®è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- **ä¸¦åˆ—åˆ¶å¾¡** - æœ€å¤§7 Worktreeã®åŒæ™‚å®Ÿè¡Œ

---

## ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Multi-AI Orchestrium                             â”‚
â”‚                   Git Worktreesçµ±åˆã‚·ã‚¹ãƒ†ãƒ                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                        â”‚                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼  â”‚        â”‚  ã‚³ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒª â”‚       â”‚  ã‚µãƒãƒ¼ãƒˆ     â”‚
â”‚  ãƒ¬ã‚¤ãƒ¤ãƒ¼     â”‚        â”‚  ãƒ¬ã‚¤ãƒ¤ãƒ¼       â”‚       â”‚  ãƒ¬ã‚¤ãƒ¤ãƒ¼     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â”‚                        â”‚                        â”‚
        â”‚                        â”‚                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   workflows  â”‚  â”‚  worktree-   â”‚  â”‚  vibe-logger â”‚         â”‚
â”‚  â”‚   -core.sh   â”‚  â”‚  core.sh     â”‚  â”‚  -lib.sh     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                            â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   workflows  â”‚  â”‚  worktree-   â”‚  â”‚  worktree-   â”‚         â”‚
â”‚  â”‚   -review.sh â”‚  â”‚  state.sh    â”‚  â”‚  errors.sh   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   workflows  â”‚  â”‚  worktree-   â”‚  â”‚  worktree-   â”‚         â”‚
â”‚  â”‚   -quad.sh   â”‚  â”‚  history.sh  â”‚  â”‚  metrics.sh  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  workflows-  â”‚  â”‚  worktree-   â”‚  â”‚  worktree-   â”‚         â”‚
â”‚  â”‚  coa.sh      â”‚  â”‚  merge.sh    â”‚  â”‚  execution.shâ”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                  â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                    â”‚  worktree-   â”‚                             â”‚
â”‚                    â”‚  cleanup.sh  â”‚                             â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                        â”‚                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚  Git Worktreeâ”‚        â”‚  7AIå®Ÿè¡Œç’°å¢ƒ   â”‚       â”‚  ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸   â”‚
â”‚  (Git 2.5+)  â”‚        â”‚  (Bash 4.0+)   â”‚       â”‚  (NDJSON)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¾å­˜é–¢ä¿‚

### ä¾å­˜é–¢ä¿‚ã‚°ãƒ©ãƒ•

```
worktree-core.sh
    â”œâ”€ vibe-logger-lib.sh (å¤–éƒ¨ä¾å­˜)
    â”œâ”€ worktree-errors.sh
    â”œâ”€ worktree-state.sh
    â””â”€ worktree-metrics.sh (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)

worktree-state.sh
    â”œâ”€ vibe-logger-lib.sh
    â””â”€ jq (å¤–éƒ¨ä¾å­˜)

worktree-history.sh
    â”œâ”€ vibe-logger-lib.sh
    â”œâ”€ jq (å¤–éƒ¨ä¾å­˜)
    â””â”€ worktree-state.sh (é–“æ¥)

worktree-metrics.sh
    â”œâ”€ vibe-logger-lib.sh
    â”œâ”€ jq (å¤–éƒ¨ä¾å­˜)
    â””â”€ worktree-history.sh

worktree-merge.sh
    â”œâ”€ worktree-core.sh
    â”œâ”€ worktree-state.sh
    â””â”€ git (å¤–éƒ¨ä¾å­˜)

worktree-execution.sh
    â”œâ”€ worktree-core.sh
    â”œâ”€ worktree-state.sh
    â”œâ”€ worktree-history.sh
    â”œâ”€ worktree-cleanup.sh
    â””â”€ timeout (å¤–éƒ¨ä¾å­˜)

worktree-cleanup.sh
    â”œâ”€ worktree-core.sh
    â””â”€ worktree-state.sh

worktree-errors.sh
    â””â”€ (ä¾å­˜ãªã—ã€ä»–ã‹ã‚‰ä¾å­˜ã•ã‚Œã‚‹)
```

### å¤–éƒ¨ä¾å­˜é–¢ä¿‚

| ä¾å­˜é–¢ä¿‚ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” | å¿…é ˆ |
|---------|----------|------|------|
| Bash | 4.0+ | ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ | âœ… å¿…é ˆ |
| Git | 2.5+ | Worktreeæ©Ÿèƒ½ | âœ… å¿…é ˆ |
| jq | 1.5+ | JSONå‡¦ç† | âœ… å¿…é ˆ |
| timeout | coreutils | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆåˆ¶å¾¡ | âœ… å¿…é ˆ |
| whiptail/dialog | - | å¯¾è©±å¼UI | âŒ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ |

---

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### Worktreeä½œæˆã‹ã‚‰å‰Šé™¤ã¾ã§ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Worktreeä½œæˆãƒ•ãƒ­ãƒ¼                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Request
     â”‚
     â–¼
create_worktree("qwen")
     â”‚
     â”œâ”€ validate AI name
     â”‚       â”‚
     â”‚       â–¼
     â”‚  [worktree-errors.sh]
     â”‚   error_invalid_ai_name()
     â”‚
     â”œâ”€ acquire lock
     â”‚       â”‚
     â”‚       â–¼
     â”‚  acquire_worktree_lock()
     â”‚   (WT401 on failure)
     â”‚
     â”œâ”€ update state: "creating"
     â”‚       â”‚
     â”‚       â–¼
     â”‚  [worktree-state.sh]
     â”‚   update_worktree_state("qwen", "creating")
     â”‚       â”‚
     â”‚       â–¼
     â”‚  logs/worktree-state/.state.json (NDJSON)
     â”‚  {"timestamp":"...","ai":"qwen","state":"creating",...}
     â”‚
     â”œâ”€ execute git worktree add
     â”‚       â”‚
     â”‚       â–¼
     â”‚  git worktree add -b ai/qwen/YYYYMMDD-HHMMSS worktrees/qwen
     â”‚   (WT101 on failure)
     â”‚
     â”œâ”€ update state: "active"
     â”‚       â”‚
     â”‚       â–¼
     â”‚  update_worktree_state("qwen", "active")
     â”‚
     â”œâ”€ record history
     â”‚       â”‚
     â”‚       â–¼
     â”‚  [worktree-history.sh]
     â”‚   record_worktree_execution_start("workflow", "qwen")
     â”‚       â”‚
     â”‚       â–¼
     â”‚  logs/worktree-history/YYYYMMDD/history.ndjson
     â”‚  {"timestamp":"...","workflow":"...","ai":"qwen","event":"start",...}
     â”‚
     â”œâ”€ release lock
     â”‚       â”‚
     â”‚       â–¼
     â”‚  release_worktree_lock()
     â”‚
     â””â”€ return success (0)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. AIå®Ÿè¡Œãƒ•ãƒ­ãƒ¼                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

execute_in_worktree("qwen", "command")
     â”‚
     â”œâ”€ change directory
     â”‚       â”‚
     â”‚       â–¼
     â”‚  cd worktrees/qwen
     â”‚
     â”œâ”€ execute command with timeout
     â”‚       â”‚
     â”‚       â–¼
     â”‚  timeout 600 bash -c "command"
     â”‚   (exit 124 on timeout)
     â”‚
     â”œâ”€ record resource usage (optional)
     â”‚       â”‚
     â”‚       â–¼
     â”‚  [worktree-metrics.sh]
     â”‚   record_resource_usage("workflow")
     â”‚       â”‚
     â”‚       â–¼
     â”‚  logs/worktree-metrics/metrics.ndjson
     â”‚  {"timestamp":"...","workflow":"...","cpu":50,"memory":1024,...}
     â”‚
     â””â”€ return exit code


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Worktreeãƒãƒ¼ã‚¸ãƒ•ãƒ­ãƒ¼                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

merge_worktree_branch("qwen", "main", "no-ff")
     â”‚
     â”œâ”€ check conflicts
     â”‚       â”‚
     â”‚       â–¼
     â”‚  check_merge_conflicts("qwen")
     â”‚       â”‚
     â”‚       â”œâ”€ no conflicts â†’ continue
     â”‚       â””â”€ conflicts â†’ visualize_merge_conflicts()
     â”‚                           â”‚
     â”‚                           â–¼
     â”‚                    conflict report (WT302)
     â”‚
     â”œâ”€ execute merge
     â”‚       â”‚
     â”‚       â–¼
     â”‚  git merge --no-ff ai/qwen/YYYYMMDD-HHMMSS
     â”‚   (WT301 on failure)
     â”‚
     â””â”€ return success (0)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Worktreeå‰Šé™¤ãƒ•ãƒ­ãƒ¼                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

cleanup_worktree("qwen")
     â”‚
     â”œâ”€ update state: "cleaning"
     â”‚       â”‚
     â”‚       â–¼
     â”‚  update_worktree_state("qwen", "cleaning")
     â”‚
     â”œâ”€ try normal remove
     â”‚       â”‚
     â”‚       â–¼
     â”‚  git worktree remove worktrees/qwen
     â”‚       â”‚
     â”‚       â”œâ”€ success â†’ continue
     â”‚       â””â”€ failure â†’ retry with --force
     â”‚                       â”‚
     â”‚                       â–¼
     â”‚              git worktree remove worktrees/qwen --force
     â”‚               (retry 3 times, 1s interval)
     â”‚
     â”œâ”€ delete branch
     â”‚       â”‚
     â”‚       â–¼
     â”‚  git branch -D ai/qwen/YYYYMMDD-HHMMSS
     â”‚
     â”œâ”€ record history
     â”‚       â”‚
     â”‚       â–¼
     â”‚  record_worktree_execution_end("workflow", "qwen", "success", duration)
     â”‚       â”‚
     â”‚       â–¼
     â”‚  logs/worktree-history/YYYYMMDD/history.ndjson
     â”‚  {"timestamp":"...","workflow":"...","ai":"qwen","event":"end","status":"success","duration":330}
     â”‚
     â”œâ”€ update state: "none"
     â”‚       â”‚
     â”‚       â–¼
     â”‚  update_worktree_state("qwen", "none")
     â”‚
     â””â”€ return success (0)
```

---

## çŠ¶æ…‹é·ç§»

### WorktreeçŠ¶æ…‹é·ç§»å›³

```
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚              â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”‚     none     â”‚â—„â”€â”€â”€â”€â”€â”€â”
         â”‚      â”‚   (åˆæœŸçŠ¶æ…‹)  â”‚       â”‚
         â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
         â”‚             â”‚               â”‚
         â”‚  create_    â”‚               â”‚cleanup_
         â”‚  worktree() â”‚               â”‚worktree()
         â”‚             â”‚               â”‚
         â”‚      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”       â”‚
         â”‚      â”‚              â”‚       â”‚
         â”‚      â”‚  creating    â”‚       â”‚
         â”‚      â”‚  (ä½œæˆä¸­)     â”‚       â”‚
         â”‚      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
         â”‚             â”‚               â”‚
         â”‚  success    â”‚               â”‚
         â”‚             â”‚               â”‚
         â”‚      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”       â”‚
         â”‚      â”‚              â”‚       â”‚
         â””â”€â”€â”€â”€â”€â”€â”¤   active     â”œâ”€â”€â”€â”€â”€â”€â”€â”˜
  error         â”‚  (å®Ÿè¡Œä¸­)     â”‚  cleanup_
  (ç•°å¸¸)        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  worktree()
         â”‚             â”‚               â”‚
         â”‚  cleanup_   â”‚               â”‚
         â”‚  worktree() â”‚               â”‚
         â”‚             â”‚               â”‚
         â”‚      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”       â”‚
         â”‚      â”‚              â”‚       â”‚
         â””â”€â”€â”€â”€â”€â–ºâ”‚  cleaning    â”œâ”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚  (å‰Šé™¤ä¸­)     â”‚
                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                  success/error
                       â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                â”‚              â”‚
                â”‚    none      â”‚
                â”‚   (å®Œäº†)      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¨±å¯ã•ã‚Œã‚‹çŠ¶æ…‹é·ç§»:
  none      â†’ creating
  creating  â†’ active, error
  active    â†’ cleaning, error
  cleaning  â†’ none, error
  error     â†’ none (ãƒªã‚«ãƒãƒªãƒ¼)

ä¸æ­£ãªçŠ¶æ…‹é·ç§»ã®ä¾‹:
  none      â†’ active    (X) - ä½œæˆãƒ•ã‚§ãƒ¼ã‚ºã‚’ã‚¹ã‚­ãƒƒãƒ—
  creating  â†’ cleaning  (X) - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–å‰ã«å‰Šé™¤
  cleaning  â†’ creating  (X) - å‰Šé™¤ä¸­ã«ä½œæˆ
```

### ä¸¦åˆ—å®Ÿè¡Œæ™‚ã®çŠ¶æ…‹é·ç§»

```
Time  â”‚ Qwen      â”‚ Droid     â”‚ Claude    â”‚ Gemini    â”‚
â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
t=0   â”‚ none      â”‚ none      â”‚ none      â”‚ none      â”‚
      â”‚           â”‚           â”‚           â”‚           â”‚
t=1   â”‚ creating  â”‚ creating  â”‚ creating  â”‚ creating  â”‚ (ä¸¦åˆ—ä½œæˆ)
      â”‚           â”‚           â”‚           â”‚           â”‚
t=2   â”‚ active    â”‚ active    â”‚ active    â”‚ active    â”‚
      â”‚           â”‚           â”‚           â”‚           â”‚
t=3   â”‚ active    â”‚ active    â”‚ active    â”‚ active    â”‚ (ä¸¦åˆ—å®Ÿè¡Œ)
...   â”‚ (å®Ÿè¡Œä¸­)   â”‚ (å®Ÿè¡Œä¸­)   â”‚ (å®Ÿè¡Œä¸­)   â”‚ (å®Ÿè¡Œä¸­)   â”‚
      â”‚           â”‚           â”‚           â”‚           â”‚
t=100 â”‚ cleaning  â”‚ active    â”‚ active    â”‚ active    â”‚ (Qwenå®Œäº†)
      â”‚           â”‚           â”‚           â”‚           â”‚
t=101 â”‚ none      â”‚ cleaning  â”‚ active    â”‚ active    â”‚
      â”‚           â”‚           â”‚           â”‚           â”‚
t=102 â”‚ none      â”‚ none      â”‚ cleaning  â”‚ active    â”‚
      â”‚           â”‚           â”‚           â”‚           â”‚
t=103 â”‚ none      â”‚ none      â”‚ none      â”‚ cleaning  â”‚
      â”‚           â”‚           â”‚           â”‚           â”‚
t=104 â”‚ none      â”‚ none      â”‚ none      â”‚ none      â”‚ (å…¨å®Œäº†)
```

---

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä¾‹

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼1: åŸºæœ¬çš„ãªé †æ¬¡å®Ÿè¡Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ multi-ai-speed-prototype (2AIé †æ¬¡å®Ÿè¡Œ)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: Setup
  â”œâ”€ setup_worktree_cleanup_trap()
  â””â”€ validate workflow

Step 2: Qwen High-Speed Prototype
  â”œâ”€ create_worktree("qwen")
  â”œâ”€ execute_in_worktree("qwen", "prototype.sh", 300s)
  â”œâ”€ merge_worktree_branch("qwen", "main", "no-ff")
  â””â”€ cleanup_worktree("qwen")

Step 3: Droid Quality Assurance
  â”œâ”€ create_worktree("droid")
  â”œâ”€ execute_in_worktree("droid", "qa.sh", 900s)
  â”œâ”€ merge_worktree_branch("droid", "main", "no-ff")
  â””â”€ cleanup_worktree("droid")

Step 4: Teardown
  â”œâ”€ cleanup_all_worktrees()
  â””â”€ teardown_worktree_cleanup_trap()

Total Time: 2-4 minutes
```

---

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼2: å®Œå…¨ä¸¦åˆ—å®Ÿè¡Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ multi-ai-full-orchestrate (7AIä¸¦åˆ—å®Ÿè¡Œ)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: Setup
  â”œâ”€ setup_worktree_cleanup_trap()
  â””â”€ export MAX_PARALLEL_WORKTREES=4

Step 2: Parallel Worktree Creation
  â””â”€ create_worktrees_parallel claude gemini amp qwen droid codex cursor
       â”‚
       â”œâ”€ Group 1 (4ä¸¦åˆ—): claude, gemini, amp, qwen
       â”‚    â””â”€ ä¸¦åˆ—ä½œæˆ: ç´„0.2ç§’
       â”‚
       â””â”€ Group 2 (3ä¸¦åˆ—): droid, codex, cursor
            â””â”€ ä¸¦åˆ—ä½œæˆ: ç´„0.2ç§’

       Total Creation Time: ç´„0.4ç§’

Step 3: Phase 1 - Strategic Planning (ä¸¦åˆ—)
  â”œâ”€ Claude: Architecture Design (300s) â—„â”€â”€â”€â”
  â”œâ”€ Gemini: Requirements Research (300s) â—„â”€â”¤ ä¸¦åˆ—å®Ÿè¡Œ
  â””â”€ Amp: Project Management (600s) â—„â”€â”€â”€â”€â”€â”€â”€â”˜

Step 4: Phase 2 - Parallel Implementation (ä¸¦åˆ—)
  â”œâ”€ Qwen: Fast Prototype (300s) â—„â”€â”€â”€â”€â”€â”€â”
  â””â”€ Droid: Enterprise Quality (900s) â—„â”€â”€â”˜ ä¸¦åˆ—å®Ÿè¡Œ

Step 5: Phase 3 - Integration & Review (é †æ¬¡)
  â”œâ”€ Codex: Compare & Optimize (300s)
  â”‚    â””â”€ Input: Qwen + Droid outputs
  â””â”€ Cursor: IDE Integration & Testing (600s)

Step 6: Merge & Cleanup
  â”œâ”€ merge_all_sequential(main, no-ff, claude gemini amp qwen droid codex cursor)
  â”œâ”€ cleanup_all_worktrees()
  â””â”€ teardown_worktree_cleanup_trap()

Total Time: 5-8 minutes
Parallelism: æœ€å¤§7 Worktrees
```

---

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼3: ã‚¨ãƒ©ãƒ¼ãƒªã‚«ãƒãƒªãƒ¼ä»˜ãå®Ÿè¡Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Worktreeãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆã‚¨ãƒ©ãƒ¼ãƒªã‚«ãƒãƒªãƒ¼çµ±åˆï¼‰                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Pre-Execution Health Check
  â”œâ”€ check_worktree_health()
  â”‚    â””â”€ Detect orphaned worktrees/branches
  â”‚
  â””â”€ auto_recover_worktrees()
       â”œâ”€ recover_orphaned_worktrees()
       â”œâ”€ recover_orphaned_branches()
       â”œâ”€ recover_stale_states()
       â””â”€ recover_stale_locks()

Main Execution
  â”œâ”€ create_worktree("qwen")
  â”‚
  â”œâ”€ execute_in_worktree("qwen", "task.sh", 600s)
  â”‚    â”‚
  â”‚    â”œâ”€ success â†’ continue
  â”‚    â””â”€ failure/timeout
  â”‚         â”œâ”€ log_recovery_event()
  â”‚         â”œâ”€ cleanup_worktree("qwen")
  â”‚         â””â”€ exit 1
  â”‚
  â””â”€ cleanup_worktree("qwen")

Post-Execution Analysis
  â”œâ”€ get_execution_statistics()
  â”œâ”€ get_recovery_statistics()
  â””â”€ generate_history_report()
```

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

### ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰æ§‹é€ 

```
multi-ai-orchestrium/
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ orchestrate/
â”‚       â”œâ”€â”€ orchestrate-multi-ai.sh         # ãƒ¡ã‚¤ãƒ³ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼
â”‚       â””â”€â”€ lib/
â”‚           â”œâ”€â”€ worktree-core.sh            # (19KB, 10é–¢æ•°)
â”‚           â”œâ”€â”€ worktree-state.sh           # ( 7KB,  8é–¢æ•°)
â”‚           â”œâ”€â”€ worktree-history.sh         # (21KB,  7é–¢æ•°)
â”‚           â”œâ”€â”€ worktree-metrics.sh         # ( 9KB,  7é–¢æ•°)
â”‚           â”œâ”€â”€ worktree-merge.sh           # (27KB,  6é–¢æ•°)
â”‚           â”œâ”€â”€ worktree-execution.sh       # (37KB, 16é–¢æ•°)
â”‚           â”œâ”€â”€ worktree-cleanup.sh         # (12KB,  6é–¢æ•°)
â”‚           â””â”€â”€ worktree-errors.sh          # ( 7KB, 12é–¢æ•°)
â”‚
â”œâ”€â”€ bin/
â”‚   â””â”€â”€ vibe-logger-lib.sh                  # VibeLoggerçµ±åˆ
â”‚
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ worktree/
â”‚       â”œâ”€â”€ API_REFERENCE.md                # æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚       â”œâ”€â”€ TROUBLESHOOTING.md              # ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
â”‚       â”œâ”€â”€ ARCHITECTURE.md                 # ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
â”‚       â””â”€â”€ CONTRIBUTING.md                 # è²¢çŒ®ã‚¬ã‚¤ãƒ‰
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ test-worktree-merge.sh              # Phase 2.3ãƒ†ã‚¹ãƒˆ (16ãƒ†ã‚¹ãƒˆ)
    â”œâ”€â”€ test-worktree-state-management.sh   # Phase 2.1ãƒ†ã‚¹ãƒˆ (21ãƒ†ã‚¹ãƒˆ)
    â””â”€â”€ test-worktree-recovery.sh           # Phase 2.2ãƒ†ã‚¹ãƒˆ (10ãƒ†ã‚¹ãƒˆ)
```

### ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
multi-ai-orchestrium/
â”œâ”€â”€ worktrees/                              # Worktreeãƒ™ãƒ¼ã‚¹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚   â”œâ”€â”€ .state.json                         # NDJSONçŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ claude/                             # Claude worktree
â”‚   â”‚   â”œâ”€â”€ .git                            # Git worktreeç®¡ç†ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”‚   â””â”€â”€ ...ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”œâ”€â”€ gemini/                             # Gemini worktree
â”‚   â”œâ”€â”€ amp/
â”‚   â”œâ”€â”€ qwen/
â”‚   â”œâ”€â”€ droid/
â”‚   â”œâ”€â”€ codex/
â”‚   â””â”€â”€ cursor/
â”‚
â””â”€â”€ logs/
    â”œâ”€â”€ vibe/                               # VibeLoggerãƒ­ã‚°
    â”‚   â””â”€â”€ YYYYMMDD/
    â”‚       â””â”€â”€ *.jsonl
    â”‚
    â”œâ”€â”€ worktree-history/                   # å®Ÿè¡Œå±¥æ­´
    â”‚   â””â”€â”€ YYYYMMDD/
    â”‚       â””â”€â”€ history.ndjson
    â”‚
    â”œâ”€â”€ worktree-metrics/                   # ãƒ¡ãƒˆãƒªã‚¯ã‚¹
    â”‚   â”œâ”€â”€ metrics.ndjson
    â”‚   â””â”€â”€ dashboard.html
    â”‚
    â”œâ”€â”€ worktree-recovery/                  # ãƒªã‚«ãƒãƒªãƒ¼ãƒ­ã‚°
    â”‚   â””â”€â”€ YYYYMMDD/
    â”‚       â””â”€â”€ recovery.ndjson
    â”‚
    â””â”€â”€ worktree-test-reports/              # ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ
        â””â”€â”€ test-report-YYYYMMDD-HHMMSS.md
```

---

## è¨­è¨ˆåŸå‰‡

### 1. è²¬å‹™åˆ†é›¢ (Separation of Concerns)

å„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯æ˜ç¢ºãªè²¬å‹™ã‚’æŒã¤ï¼š

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | è²¬å‹™ | ä¾å­˜é–¢ä¿‚ |
|-----------|------|---------|
| worktree-core | Worktree CRUD | errors, state |
| worktree-state | çŠ¶æ…‹ç®¡ç† | jq |
| worktree-history | å±¥æ­´è¿½è·¡ | state |
| worktree-metrics | ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›† | history |
| worktree-merge | ãƒãƒ¼ã‚¸æˆ¦ç•¥ | core, state |
| worktree-execution | AIå®Ÿè¡Œç®¡ç† | core, history, cleanup |
| worktree-cleanup | ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ— | core, state |
| worktree-errors | ã‚¨ãƒ©ãƒ¼å‡¦ç† | - |

**åˆ©ç‚¹:**
- ä¿å®ˆæ€§ã®å‘ä¸Š
- ãƒ†ã‚¹ãƒˆã®å®¹æ˜“æ€§
- å†åˆ©ç”¨æ€§ã®å‘ä¸Š

---

### 2. NDJSONå½¢å¼ã®æ¡ç”¨

**ç†ç”±:**
- è¿½è¨˜ã®ã¿ã§é«˜é€Ÿï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ãƒƒã‚¯ä¸è¦ï¼‰
- å„è¡ŒãŒç‹¬ç«‹ã—ãŸJSONï¼ˆéƒ¨åˆ†çš„ç ´æã«å¼·ã„ï¼‰
- ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†ã«é©ã—ã¦ã„ã‚‹

**æ¬ ç‚¹:**
- æ¨™æº–çš„ãªJSONé…åˆ—ã§ã¯ãªã„ï¼ˆ`jq '.'`ãŒå¤±æ•—ï¼‰
- èª­ã¿å–ã‚Šã«å·¥å¤«ãŒå¿…è¦

**ä½¿ç”¨ç®‡æ‰€:**
- çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`.state.json`ï¼‰
- å±¥æ­´ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`history.ndjson`ï¼‰
- ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`metrics.ndjson`ï¼‰
- ãƒªã‚«ãƒãƒªãƒ¼ãƒ­ã‚°ï¼ˆ`recovery.ndjson`ï¼‰

---

### 3. ãƒ•ã‚§ã‚¤ãƒ«ã‚»ãƒ¼ãƒ•è¨­è¨ˆ

**ç•°å¸¸çµ‚äº†æ™‚ã®è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—:**
```bash
# trapè¨­å®šï¼ˆPhase 0ä¿®æ­£ï¼‰
setup_worktree_cleanup_trap()  # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é–‹å§‹æ™‚
cleanup_all_worktrees()        # EXIT/INT/TERMæ™‚ã«è‡ªå‹•å®Ÿè¡Œ
teardown_worktree_cleanup_trap()  # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼çµ‚äº†æ™‚
```

**ãƒªãƒˆãƒ©ã‚¤æ©Ÿæ§‹:**
```bash
# cleanup_worktree() å†…éƒ¨
for attempt in 1 2 3; do
  git worktree remove "$path" --force && break
  sleep 1
done
```

**çŠ¶æ…‹æ¤œè¨¼:**
```bash
# ä¸æ­£ãªçŠ¶æ…‹é·ç§»ã‚’é˜²æ­¢
validate_worktree_state_transition("active", "creating")  # â†’ false
```

---

### 4. ä¸¦åˆ—åˆ¶å¾¡

**ä¸¦åˆ—åº¦ã®å‹•çš„åˆ¶å¾¡:**
```bash
MAX_PARALLEL_WORKTREES=4  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
xargs -P $MAX_PARALLEL_WORKTREES -I {} create_worktree {}
```

**ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ­ãƒƒã‚¯:**
```bash
WORKTREE_LOCK_FILE="/tmp/multi-ai-worktree.lock"
acquire_worktree_lock()    # ãƒ­ãƒƒã‚¯å–å¾—
# ... ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ ...
release_worktree_lock()    # ãƒ­ãƒƒã‚¯è§£æ”¾
```

---

### 5. å¯è¦³æ¸¬æ€§ (Observability)

**3ç¨®é¡ã®ãƒ‡ãƒ¼ã‚¿åé›†:**

1. **VibeLogger** - ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°
```bash
vibe_log "worktree_create" "create" \
  "{\"ai\":\"$ai\",\"path\":\"$path\"}" \
  "Creating worktree for $ai"
```

2. **History** - å®Ÿè¡Œå±¥æ­´
```json
{"timestamp":"...","workflow":"...","ai":"qwen","event":"start"}
{"timestamp":"...","workflow":"...","ai":"qwen","event":"end","status":"success","duration":330}
```

3. **Metrics** - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹
```json
{"timestamp":"...","workflow":"...","cpu":50,"memory":1024,"disk":500}
```

**ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰:**
```bash
bash scripts/generate-metrics-dashboard.sh
open logs/worktree-metrics/dashboard.html
```

---

### 6. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**What/Why/Howå½¢å¼:**
```bash
error_worktree_create_failed() {
  echo "ERROR [WT101]: Failed to create worktree for AI '$ai'"
  echo ""
  echo "What: Worktree creation failed"
  echo "Why: $error_message"
  echo "How: Check disk space, verify Git configuration"
}
```

**ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä½“ç³»:**
- WT001-WT099: æ¤œè¨¼ã‚¨ãƒ©ãƒ¼
- WT101-WT199: ä½œæˆã‚¨ãƒ©ãƒ¼
- WT201-WT299: å‰Šé™¤ã‚¨ãƒ©ãƒ¼
- WT301-WT399: ãƒãƒ¼ã‚¸ã‚¨ãƒ©ãƒ¼
- WT401-WT499: ä¸¦åˆ—åˆ¶å¾¡ã‚¨ãƒ©ãƒ¼
- WT501-WT599: çŠ¶æ…‹ç®¡ç†ã‚¨ãƒ©ãƒ¼
- WT901-WT999: ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼

---

### 7. ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º (TDD)

**ãƒ†ã‚¹ãƒˆæ§‹æˆ:**
- Phase 2.3: ãƒãƒ¼ã‚¸æˆ¦ç•¥ãƒ†ã‚¹ãƒˆ (16ãƒ†ã‚¹ãƒˆã€100%æˆåŠŸ)
- Phase 2.1: çŠ¶æ…‹ç®¡ç†ãƒ†ã‚¹ãƒˆ (21ãƒ†ã‚¹ãƒˆã€100%æˆåŠŸ)
- Phase 2.2: ãƒªã‚«ãƒãƒªãƒ¼ãƒ†ã‚¹ãƒˆ (10ãƒ†ã‚¹ãƒˆã€90%æˆåŠŸ)

**ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–:**
```bash
# GitHub Actions CI/CD
bash scripts/run-all-worktree-tests.sh
# â†’ 47ãƒ†ã‚¹ãƒˆã€46æˆåŠŸ (97.9%)
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™

### Worktreeä½œæˆæ™‚é–“

| ä¸¦åˆ—åº¦ | 7 Worktreesä½œæˆæ™‚é–“ | é«˜é€ŸåŒ–ç‡ |
|--------|---------------------|---------|
| é †æ¬¡ (1) | 3.5ç§’ | 1.0x (ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³) |
| 2ä¸¦åˆ— | 1.8ç§’ | 1.9x |
| 4ä¸¦åˆ— | 0.7ç§’ | **5.0x** âœ… |
| 7ä¸¦åˆ— | 0.5ç§’ | 7.0x |

**æ¨å¥¨:** 4ä¸¦åˆ—ï¼ˆãƒªã‚½ãƒ¼ã‚¹åŠ¹ç‡ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ãƒãƒ©ãƒ³ã‚¹ï¼‰

---

### ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æˆåŠŸç‡

| ãƒ•ã‚§ãƒ¼ã‚º | æˆåŠŸç‡ | å‚™è€ƒ |
|---------|-------|------|
| Phase 0ä»¥å‰ | 85.7% | trapè¨­å®šã‚¿ã‚¤ãƒŸãƒ³ã‚°å•é¡Œ |
| Phase 0ä¿®æ­£å¾Œ | **100%** âœ… | æ˜ç¤ºçš„trapç®¡ç† |

---

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œæ™‚é–“

| ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ | AIæ•° | ä¸¦åˆ—åº¦ | å®Ÿè¡Œæ™‚é–“ |
|-------------|------|--------|---------|
| speed-prototype | 2 | é †æ¬¡ | 2-4åˆ† |
| full-orchestrate | 7 | 4ä¸¦åˆ— | 5-8åˆ† |
| enterprise-quality | 1 | - | 15-20åˆ† |
| hybrid-development | 4 | 2ä¸¦åˆ— | 5-15åˆ† |

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### ãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™

| ãƒ•ã‚¡ã‚¤ãƒ« | æ¨©é™ | ç†ç”± |
|---------|------|------|
| worktrees/ | 700 | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ |
| .state.json | 600 | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿èª­ã¿æ›¸ã |
| ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ« | 600 | åŒæ™‚ã‚¢ã‚¯ã‚»ã‚¹é˜²æ­¢ |

### å…¥åŠ›æ¤œè¨¼

```bash
# AIåã®æ¤œè¨¼
valid_ais=("claude" "gemini" "amp" "qwen" "droid" "codex" "cursor")
if [[ ! " ${valid_ais[@]} " =~ " ${ai} " ]]; then
  error_invalid_ai_name "$ai"
  return 1
fi
```

### ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«å¯¾ç­–

```bash
# Worktreeãƒ‘ã‚¹ã®æ­£è¦åŒ–
worktree_path=$(realpath "$WORKTREE_BASE_DIR/$ai")
if [[ ! "$worktree_path" =~ ^"$(realpath "$WORKTREE_BASE_DIR")" ]]; then
  echo "ERROR: Invalid path" >&2
  return 1
fi
```

---

## æ‹¡å¼µæ€§

### æ–°ã—ã„AIã®è¿½åŠ 

**æ‰‹é †:**
1. AIåã‚’`valid_ais`é…åˆ—ã«è¿½åŠ 
2. ãƒ©ãƒƒãƒ‘ãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆï¼ˆ`bin/<ai>-wrapper.sh`ï¼‰
3. ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ›´æ–°ï¼ˆ`config/multi-ai-profiles.yaml`ï¼‰
4. ãƒ†ã‚¹ãƒˆè¿½åŠ 

**ä¾‹:**
```bash
# worktree-core.sh
valid_ais=("claude" "gemini" "amp" "qwen" "droid" "codex" "cursor" "new-ai")

# config/multi-ai-profiles.yaml
workflows:
  my-workflow:
    phases:
      - ai: new-ai
        role: custom-role
        timeout: 600
```

---

### æ–°ã—ã„ãƒãƒ¼ã‚¸æˆ¦ç•¥ã®è¿½åŠ 

**æ‰‹é †:**
1. `worktree-merge.sh`ã«æ–°ã—ã„æˆ¦ç•¥ã‚’è¿½åŠ 
2. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¿½åŠ 
3. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

**ä¾‹:**
```bash
# worktree-merge.sh
case "$strategy" in
  # ... æ—¢å­˜æˆ¦ç•¥ ...
  my-strategy)
    git merge --strategy=my-strategy "$source_branch"
    ;;
esac
```

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [APIãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](API_REFERENCE.md) - å…¨é–¢æ•°ã®è©³ç´°ä»•æ§˜
- [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](TROUBLESHOOTING.md) - ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–
- [è²¢çŒ®ã‚¬ã‚¤ãƒ‰](CONTRIBUTING.md) - é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [WORKTREE_TEST_PROCEDURE.md](../../WORKTREE_TEST_PROCEDURE.md) - ãƒ†ã‚¹ãƒˆæ‰‹é †æ›¸

---

**æœ€çµ‚æ›´æ–°:** 2025-11-08
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** v1.0
**ãƒ¡ãƒ³ãƒ†ãƒŠãƒ¼:** Multi-AI Orchestrium Contributors
